<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Before I Go Out - Basic Map & Weather</title>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 420px;
    margin: 2rem auto;
    padding: 1rem;
    text-align: center;
  }
  #map {
    height: 300px;
    margin: 1rem auto;
    max-width: 420px;
  }
</style>
</head>
<body>
<h1>Before I Go Out</h1>
<div id="status">Checking location...</div>
<div id="weather"></div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const statusEl = document.getElementById('status');
  const weatherEl = document.getElementById('weather');
  let map;

  function fetchWeather(lat, lon) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph`;
    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (data.current_weather) {
          const w = data.current_weather;
          weatherEl.innerHTML = `<p>Weather: ${w.temperature}Â°F, Wind: ${w.windspeed} mph</p>`;
        } else {
          weatherEl.textContent = 'Weather data unavailable.';
        }
      })
      .catch(() => {
        weatherEl.textContent = 'Error fetching weather.';
      });
  }

  function initMap(lat, lon) {
    map = L.map('map').setView([lat, lon], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors',
    }).addTo(map);
    L.marker([lat, lon]).addTo(map).bindPopup('You are here').openPopup();
  }

  function success(pos) {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    statusEl.textContent = 'Location found.';
    fetchWeather(lat, lon);
    initMap(lat, lon);
  }

  function error() {
    statusEl.textContent = 'Could not get location.';
  }

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(success, error);
  } else {
    statusEl.textContent = 'Geolocation not supported.';
  }
</script>
</body>
</html>
